{% extends "base/base.html" %}
{% load static %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'style/home/home.css' %}">
{% endblock %}

{% block content %}
<!-- Toast Notifications Container -->
<div id="toast-container" class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 9999;">
    {% if messages %}
        {% for message in messages %}
            <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header {% if message.tags == 'error' %}bg-danger text-white{% elif message.tags == 'success' %}bg-success text-white{% elif message.tags == 'warning' %}bg-warning text-dark{% elif 'üëç' in message %}bg-like text-white{% elif 'üí¨' in message %}bg-comment text-white{% else %}bg-info text-white{% endif %}">
                    <i class="fas fa-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'error' %}exclamation-triangle{% elif message.tags == 'warning' %}exclamation-triangle{% elif 'üëç' in message %}thumbs-up{% elif 'üí¨' in message %}comment{% else %}info-circle{% endif %} me-2"></i>
                    <strong class="me-auto">
                        {% if message.tags == 'error' %}L·ªói{% elif message.tags == 'success' %}Th√†nh c√¥ng{% elif message.tags == 'warning' %}C·∫£nh b√°o{% elif 'üëç' in message %}Th√≠ch b√†i vi·∫øt{% elif 'üí¨' in message %}B√¨nh lu·∫≠n{% else %}Th√¥ng b√°o{% endif %}
                    </strong>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    {{ message }}
                </div>
            </div>
        {% endfor %}
    {% endif %}
</div>

<!-- Hero Section -->
<section class="hero-section">
    <div class="container">
        <div class="hero-content text-center">
            <img src="{% static 'images/Logo_noback_white.png' %}" alt="Logo" class="logo-image" style="width: 220px; height: 200px; margin-bottom: 20px; margin-top: 0px;">
            <p class="hero-subtitle">STEMIND l√† n·ªÅn t·∫£ng tr·ª±c tuy·∫øn t√≠ch h·ª£p AI ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ gi√∫p gi√°o vi√™n nhanh ch√≥ng thi·∫øt k·∫ø b√†i gi·∫£ng STEM, t√¨m ki·∫øm t√†i li·ªáu h·ªçc t·∫≠p ph√π h·ª£p v√† t·ªï ch·ª©c c√°c ho·∫°t ƒë·ªông. V·ªõi giao di·ªán th√¢n thi·ªán, ti·∫øt ki·ªám th·ªùi gian, n√¢ng cao ch·∫•t l∆∞·ª£ng gi·∫£ng d·∫°y v√† k·∫øt n·ªëi c·ªông ƒë·ªìng.</p>
            <div class="hero-stats">
                <div class="hero-stat">
                    {% comment %} {{ featured_files|length }} {% endcomment %}
                    <span class="hero-stat-number">50+</span>
                    <span class="hero-stat-label">T√†i li·ªáu ch·∫•t l∆∞·ª£ng</span>
                </div>
                <div class="hero-stat">
                    {% comment %} {{ top_users|length }} {% endcomment %}
                    <span class="hero-stat-number">100+</span>
                    <span class="hero-stat-label">Gi√°o vi√™n tham gia</span>
                </div>
                <div class="hero-stat">
                    {% comment %} {{ categories|length }} {% endcomment %}
                    <span class="hero-stat-number">500+</span>
                    <span class="hero-stat-label">B√†i gi·∫£ng ƒë∆∞·ª£c t·∫°o</span>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Featured Files Section -->
<section class="featured-section">
    <div class="container">
        <div class="d-flex align-items-center justify-content-between mb-4">
            <h2 class="section-title mb-0">T√†i li·ªáu n·ªïi b·∫≠t</h2>
            <small class="text-muted">
                <i class="fas fa-arrow-right me-1"></i>K√©o ƒë·ªÉ xem th√™m
            </small>
        </div>
        <div class="featured-scroll-container">
            <div class="featured-grid">
                {% for file in featured_files %}
                <article class="featured-card">
                    <a href="{% url 'file_detail' file.title %}" class="text-decoration-none">
                        <div class="featured-card-image">
                            <img src="{{ file.get_thumbnail_presigned_url }}" alt="{{ file.title }}" loading="lazy">
                            <div class="featured-card-overlay"></div>
                        </div>
                        <div class="featured-card-content">
                            <h3 class="featured-card-title">{{ file.title }}</h3>
                            <p class="featured-card-description">{{ file.file_description|linebreaksbr }}</p>
                            <div class="featured-card-author">
                                <i class="fas fa-user"></i>
                                <span>{{ file.author.username }}</span>
                            </div>
                            <div class="featured-card-footer">
                                <div class="featured-card-infor">{{ file.file_downloads }} l∆∞·ª£t t·∫£i</div>
                                <div class="featured-card-price">
                                    {% if file.file_status == 0 %}
                                        <span class="badge bg-success">Mi·ªÖn ph√≠</span>
                                    {% else %}
                                        <span class="badge bg-warning">{{ file.file_price|floatformat:0 }} VNƒê</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </a>
                </article>
                {% endfor %}
            </div>
        </div>
    </div>
</section>

<!-- Recent Files & Sidebar Section -->
<section class="recent-section">
    <div class="container">
        <div class="row g-4">
            <div class="col-lg-8">
                <h2 class="section-title text-start">T√†i li·ªáu m·ªõi nh·∫•t</h2>
                {% for file in recently_files %}
                <article class="recent-item">
                    <a href="{% url 'file_detail' file.title %}" class="text-decoration-none d-flex align-items-center gap-3 w-100">
                        <div class="recent-item-image">
                            <img src="{{ file.get_thumbnail_presigned_url }}" alt="{{ file.title }}" loading="lazy">
                        </div>
                        <div class="recent-item-content">
                            <h4 class="recent-item-title">{{ file.title }}</h4>
                            <div class="recent-item-meta">
                                <p class="recent-item-date">{{ file.created_at|timesince }} tr∆∞·ªõc b·ªüi {{ file.author.username }}</p>
                                <div class="recent-item-price">
                                    {% if file.file_status == 0 %}
                                        <span class="badge bg-success">Mi·ªÖn ph√≠</span>
                                    {% else %}
                                        <span class="badge bg-warning">{{ file.file_price|floatformat:0 }} VNƒê</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </a>
                </article>
                {% endfor %}
            </div>
            
            <div class="col-lg-4">
                <div class="sidebar-section">
                    <div class="sidebar-card">
                        <h3 class="sidebar-title">
                            <i class="fas fa-info-circle me-2"></i>
                            Gi·ªõi thi·ªáu
                        </h3>
                        <p>STEMIND l√† n·ªÅn t·∫£ng tr·ª±c tuy·∫øn t√≠ch h·ª£p AI ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ gi√∫p gi√°o vi√™n nhanh ch√≥ng thi·∫øt k·∫ø b√†i gi·∫£ng STEM, t√¨m ki·∫øm t√†i li·ªáu h·ªçc t·∫≠p ph√π h·ª£p v√† t·ªï ch·ª©c c√°c ho·∫°t ƒë·ªông. V·ªõi giao di·ªán th√¢n thi·ªán, ti·∫øt ki·ªám th·ªùi gian, n√¢ng cao ch·∫•t l∆∞·ª£ng gi·∫£ng d·∫°y v√† k·∫øt n·ªëi c·ªông ƒë·ªìng.</p>
                    </div>
                    {% if user.is_authenticated %}
                    <div class="sidebar-card">
                        <h3 class="sidebar-title">
                            <i class="fas fa-link me-2"></i>
                            Thao t√°c nhanh
                        </h3>
                        <div class="d-grid gap-2">
                            <a href="{% url 'search_files' %}" class="btn btn-outline-primary">
                                <i class="fas fa-search me-2"></i>T√¨m ki·∫øm t√†i li·ªáu
                            </a>
                            <a href="{% url 'upload_file' %}" class="btn btn-outline-warning">
                                <i class="fas fa-plus me-2"></i>T·∫°o t√†i li·ªáu m·ªõi
                            </a>
                            <a href="{% url 'user_favorites' %}" class="btn btn-outline-info">
                                <i class="fas fa-heart me-2"></i>T√†i li·ªáu y√™u th√≠ch
                            </a>
                        </div>
                    </div>
                    {% endif %}
                    <div class="sidebar-card">
                        <h3 class="sidebar-title">
                            <i class="fas fa-star me-2"></i>
                            Ng∆∞·ªùi ƒë√≥ng g√≥p n·ªïi b·∫≠t
                        </h3>
                        {% if top_users %}
                            {% for user in top_users %}
                            <div class="contributor-item">
                                <div class="contributor-avatar">
                                    {{ user.username|slice:":1"|upper }}
                                </div>
                                <div>
                                    <a href="{% url 'social:profile' user.username %}"><h6 class="mb-0" style="decoration:none, text-underline:none">{{ user.get_full_name|default:user.username }}</h6></a>
                                    <small class="text-muted">{{ user.files.count|default:0 }} t√†i li·ªáu</small>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <p class="text-muted mb-0">Ch∆∞a c√≥ ng∆∞·ªùi ƒë√≥ng g√≥p n√†o.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock content %}

{% block extra_js %}
<script src="{% static 'script/home/home.js' %}"></script>
<script>
// Auto-hide toast notifications after 5 seconds
document.addEventListener('DOMContentLoaded', function() {
    const toasts = document.querySelectorAll('.toast');
    toasts.forEach(function(toast) {
        // Auto-hide after 5 seconds
        setTimeout(function() {
            toast.classList.add('hide');
            setTimeout(function() {
                toast.remove();
            }, 300);
        }, 5000);
        
        // Manual close button
        const closeBtn = toast.querySelector('.btn-close');
        if (closeBtn) {
            closeBtn.addEventListener('click', function() {
                toast.classList.add('hide');
                setTimeout(function() {
                    toast.remove();
                }, 300);
            });
        }
    });
});
</script>
{% endblock %}
    